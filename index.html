<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acil Saƒülƒ±k Kimliƒüi V8.0</title>
    <style>
        /* --- 1. DOKUNMATƒ∞K ODAKLI TASARIM --- */
        :root {
            --primary: #e63946;
            --dark: #1d3557;
            --light: #f1faee;
            --blue: #457b9d;
            --white: #ffffff;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--light); 
            margin: 0; padding: 0; 
            color: #333;
            min-height: 100vh;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Gƒ∞ZLEME (Tƒ±klamayƒ± engellememesi i√ßin) */
        .hidden { display: none !important; }

        /* --- HEADER (BA≈ûLIK) --- */
        .header {
            background: linear-gradient(180deg, var(--dark), var(--blue));
            padding: 20px;
            padding-top: 40px;
            color: white;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }

        /* Y√ñNETƒ∞Cƒ∞ AYAR BUTONU (SAƒû √úST K√ñ≈ûE) */
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3);
            z-index: 100; /* En √ºstte kalmasƒ±nƒ± saƒülar */
        }

        .avatar {
            width: 120px; height: 120px;
            border-radius: 50%;
            border: 4px solid white;
            background: #ddd;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .main-info h1 { margin: 5px 0; font-size: 24px; font-weight: 800; }
        .disease-badge {
            background: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            display: inline-block;
            margin-top: 5px;
        }

        /* --- ƒ∞√áERƒ∞K --- */
        .content { padding: 25px; flex: 1; }

        /* B√úY√úK AI BUTONU */
        .big-btn {
            width: 100%;
            padding: 20px; /* Y√ºksekliƒüi artƒ±rdƒ±m */
            border-radius: 15px;
            border: none;
            font-size: 18px;
            font-weight: 800;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .big-btn:active { transform: scale(0.96); } /* Basƒ±lma hissi */
        .btn-ai { background: linear-gradient(45deg, #e63946, #d62828); }
        .btn-save { background: #2a9d8f; }

        /* KARTLAR */
        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 6px solid var(--dark);
        }
        .card.alert { border-left-color: var(--primary); background: #fff5f5; }
        .lbl { font-size: 12px; color: #666; font-weight: 800; display: block; margin-bottom: 4px; }
        .val { font-size: 18px; font-weight: 600; color: #000; }

        /* Aƒ∞LE GRID */
        .fam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .fam-btn {
            background: white;
            border: 2px solid #eee;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            text-decoration: none;
            color: var(--dark);
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .fam-btn:active { background: #e9ecef; border-color: #ccc; }

        /* --- FORM ALANLARI (B√úY√úK) --- */
        .input-group { margin-bottom: 20px; }
        .input-field {
            width: 100%;
            padding: 15px; /* Parmak i√ßin geni≈ü alan */
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }
        .checkbox-area { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background: #fff; border-radius: 10px; border: 1px solid #eee; }
        .chk-item { display: flex; align-items: center; gap: 8px; padding: 5px; font-size: 14px; width: 45%; }

        /* --- AI CHAT --- */
        .chat-wrap { display: flex; flex-direction: column; height: 100vh; background: var(--white); }
        .chat-top { padding: 20px; background: var(--dark); color: white; text-align: center; font-weight: bold; font-size: 18px; }
        .chat-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: #f4f4f9; }
        .msg { padding: 15px; border-radius: 15px; max-width: 85%; font-size: 16px; line-height: 1.4; }
        .bot { background: white; align-self: flex-start; border: 1px solid #ddd; color: #333; }
        .user { background: var(--dark); color: white; align-self: flex-end; }
        
        .chat-btns { padding: 20px; background: white; display: flex; flex-wrap: wrap; gap: 10px; border-top: 1px solid #eee; }
        .opt-btn {
            flex: 1 1 40%;
            padding: 15px;
            border: 2px solid var(--dark);
            background: white;
            color: var(--dark);
            border-radius: 25px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
        }
        .opt-btn:active { background: var(--dark); color: white; }

        /* ACƒ∞L KUTUSU */
        .emergency { background: var(--primary); color: white; padding: 20px; border-radius: 15px; text-align: center; animation: pulse 1s infinite; }
        .call-btn { display: block; background: white; color: var(--primary); text-decoration: none; font-size: 24px; font-weight: 900; padding: 10px; border-radius: 10px; margin-top: 10px; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="scr-view" class="app-container">
        <div class="settings-btn" onclick="Router.go('login')">‚öôÔ∏è</div>

        <div class="header">
            <img id="v-img" src="" class="avatar">
            <div class="main-info">
                <h1 id="v-name">...</h1>
                <div id="v-disease" class="disease-badge">...</div>
            </div>
        </div>

        <div class="content">
            <button onclick="AI.start()" class="big-btn btn-ai">
                üö® ACƒ∞L DURUM ASƒ∞STANI
            </button>

            <div class="card alert">
                <span class="lbl">ALERJƒ∞LER</span>
                <div id="v-allergy" class="val">...</div>
            </div>

            <div class="card">
                <span class="lbl">KAN GRUBU</span>
                <div id="v-blood" class="val">...</div>
            </div>

            <div class="card">
                <span class="lbl">ƒ∞LA√áLAR</span>
                <div id="v-meds" class="val">...</div>
            </div>

            <span class="lbl" style="margin-top: 15px; margin-bottom: 10px;">Aƒ∞LE ƒ∞LETƒ∞≈ûƒ∞M (Tƒ±kla Ara)</span>
            <div id="v-family" class="fam-grid"></div>
        </div>
    </div>

    <div id="scr-login" class="app-container hidden" style="justify-content:center; padding:30px;">
        <h2 style="text-align:center;">Y√∂netici Giri≈üi</h2>
        <input type="password" id="login-pass" class="input-field" style="text-align:center; margin: 20px 0;" placeholder="≈ûifre (01Talha55)">
        <button onclick="Admin.login()" class="big-btn" style="background:var(--dark);">Gƒ∞Rƒ∞≈û</button>
        <button onclick="Router.go('view')" class="big-btn" style="background:#999;">ƒ∞PTAL</button>
    </div>

    <div id="scr-admin" class="app-container hidden">
        <div class="chat-top" style="background: #333;">VERƒ∞ D√úZENLEME</div>
        <div class="content" style="overflow-y: auto;">
            
            <div class="input-group"><label class="lbl">AD SOYAD</label><input id="i-name" type="text" class="input-field"></div>
            <div class="input-group"><label class="lbl">FOTO LINKI</label><input id="i-img" type="text" class="input-field" placeholder="https://..."></div>
            <div class="input-group"><label class="lbl">KAN GRUBU</label><input id="i-blood" type="text" class="input-field"></div>
            
            <div class="input-group">
                <label class="lbl">HASTALIK SE√áƒ∞Mƒ∞</label>
                <select id="i-disease" class="input-field"></select>
            </div>

            <div class="input-group">
                <label class="lbl">ALERJƒ∞LER (Se√ßiniz)</label>
                <div id="i-chk-container" class="checkbox-area"></div>
                <input id="i-allergy-other" type="text" class="input-field" style="margin-top:10px;" placeholder="Diƒüer...">
            </div>

            <div class="input-group"><label class="lbl">ƒ∞LA√áLAR</label><textarea id="i-meds" class="input-field" rows="3"></textarea></div>

            <label class="lbl">Aƒ∞LE NUMARALARI (+90...)</label>
            <div class="input-group"><input id="i-dad" type="tel" class="input-field" placeholder="Baba"></div>
            <div class="input-group"><input id="i-mom" type="tel" class="input-field" placeholder="Anne"></div>
            <div class="input-group"><input id="i-bro" type="tel" class="input-field" placeholder="Erkek Karde≈ü"></div>
            <div class="input-group"><input id="i-sis" type="tel" class="input-field" placeholder="Kƒ±z Karde≈ü"></div>

            <button onclick="Admin.save()" class="big-btn btn-save">KAYDET</button>
        </div>
    </div>

    <div id="scr-ai" class="chat-wrap hidden">
        <div class="chat-top">ü§ñ Akƒ±llƒ± Asistan</div>
        <div id="chat-box" class="chat-body"></div>
        <div id="chat-opts" class="chat-btns"></div>
        <button onclick="Router.go('view')" style="padding:15px; background:#eee; border:none; font-weight:bold; color:#666;">KAPAT</button>
    </div>

<script>
/* --- VERƒ∞TABANLARI --- */
const Diseases = [
    {id:"EPIL", cat:"NEURO", name:"Epilepsi (Sara)"},
    {id:"DIA1", cat:"META", name:"Tip 1 Diyabet"},
    {id:"DIA2", cat:"META", name:"Tip 2 Diyabet"},
    {id:"KAH", cat:"HEART", name:"Kalp Hastasƒ±"},
    {id:"ASTIM", cat:"RESP", name:"Astƒ±m / KOAH"},
    {id:"ARI", cat:"ALLERGY", name:"Alerji: Arƒ±"},
    {id:"FISTIK", cat:"ALLERGY", name:"Alerji: Fƒ±stƒ±k"},
    {id:"GENEL", cat:"GENEL", name:"Diƒüer"}
];

const Allergies = ["Penisilin", "Lateks", "Arƒ±", "Fƒ±stƒ±k", "S√ºt", "Yumurta", "Toz", "Polen"];

/* --- Sƒ∞STEM √áEKƒ∞RDEƒûƒ∞ --- */
const App = {
    data: {},
    init: function() {
        try {
            const raw = localStorage.getItem('HealthDataV8');
            this.data = raw ? JSON.parse(raw) : this.defaults();
        } catch(e) { this.data = this.defaults(); }
        
        this.render();
        this.setupAdmin();
    },
    defaults: function() {
        return {
            name: "Bilgi Girilmedi",
            img: "https://ui-avatars.com/api/?name=A+C&background=random&size=150",
            blood: "-", disease: "EPIL", selectedAllergies: [], allergyNote: "", meds: "-",
            phones: {dad:"", mom:"", bro:"", sis:""}
        };
    },
    render: function() {
        const d = this.data;
        const dis = Diseases.find(x => x.id === d.disease) || Diseases[0];
        
        document.getElementById('v-name').innerText = d.name;
        document.getElementById('v-img').src = d.img;
        document.getElementById('v-disease').innerText = dis.name;
        document.getElementById('v-blood').innerText = d.blood;
        document.getElementById('v-meds').innerText = d.meds;
        
        // Alerji Birle≈ütirme
        let txt = d.selectedAllergies.join(", ");
        if(d.allergyNote) txt += (txt ? ", " : "") + d.allergyNote;
        document.getElementById('v-allergy').innerText = txt || "Yok";

        // Aile Butonlarƒ±
        const div = document.getElementById('v-family');
        div.innerHTML = "";
        const labs = {dad:"BABA", mom:"ANNE", bro:"E.KARDE≈û", sis:"K.KARDE≈û"};
        const icons = {dad:"üë®", mom:"üë©", bro:"üë¶", sis:"üëß"};
        
        let count = 0;
        for(let k in d.phones) {
            if(d.phones[k].length > 2) {
                count++;
                div.innerHTML += `<a href="tel:${d.phones[k]}" class="fam-btn"><span>${icons[k]}</span><span>${labs[k]}</span></a>`;
            }
        }
        if(count===0) div.innerHTML = "<div style='grid-column:span 2; text-align:center; color:#999;'>Numara Yok</div>";
    },
    setupAdmin: function() {
        const s = document.getElementById('i-disease');
        s.innerHTML = "";
        Diseases.forEach(d => s.innerHTML += `<option value="${d.id}">${d.name}</option>`);

        const c = document.getElementById('i-chk-container');
        c.innerHTML = "";
        Allergies.forEach(a => c.innerHTML += `<label class="chk-item"><input type="checkbox" value="${a}" class="chk"> ${a}</label>`);
    }
};

/* --- SAYFA GE√áƒ∞≈ûLERƒ∞ --- */
const Router = {
    go: function(id) {
        document.querySelectorAll('[id^="scr-"]').forEach(el => el.classList.add('hidden'));
        document.getElementById('scr-'+id).classList.remove('hidden');
        window.scrollTo(0,0);
    }
};

/* --- ADMIN --- */
const Admin = {
    login: function() {
        if(document.getElementById('login-pass').value === "01Talha55") {
            this.load();
            Router.go('admin');
        } else alert("Hatalƒ±!");
    },
    load: function() {
        const d = App.data;
        document.getElementById('i-name').value = d.name;
        document.getElementById('i-img').value = d.img;
        document.getElementById('i-blood').value = d.blood;
        document.getElementById('i-disease').value = d.disease;
        document.getElementById('i-meds').value = d.meds;
        document.getElementById('i-allergy-other').value = d.allergyNote;
        
        document.getElementById('i-dad').value = d.phones.dad;
        document.getElementById('i-mom').value = d.phones.mom;
        document.getElementById('i-bro').value = d.phones.bro;
        document.getElementById('i-sis').value = d.phones.sis;

        document.querySelectorAll('.chk').forEach(c => c.checked = d.selectedAllergies.includes(c.value));
    },
    save: function() {
        const sel = [];
        document.querySelectorAll('.chk:checked').forEach(c => sel.push(c.value));
        
        const newData = {
            name: document.getElementById('i-name').value,
            img: document.getElementById('i-img').value,
            blood: document.getElementById('i-blood').value,
            disease: document.getElementById('i-disease').value,
            meds: document.getElementById('i-meds').value,
            selectedAllergies: sel,
            allergyNote: document.getElementById('i-allergy-other').value,
            phones: {
                dad: document.getElementById('i-dad').value,
                mom: document.getElementById('i-mom').value,
                bro: document.getElementById('i-bro').value,
                sis: document.getElementById('i-sis').value
            }
        };
        localStorage.setItem('HealthDataV8', JSON.stringify(newData));
        App.data = newData;
        App.render();
        alert("Kaydedildi!");
        Router.go('view');
    }
};

/* --- AI --- */
const AI = {
    start: function() {
        Router.go('ai');
        document.getElementById('chat-box').innerHTML = "";
        const dis = Diseases.find(x => x.id === App.data.disease) || Diseases[0];
        
        this.type(`Ben AI Asistan. Hasta Tanƒ±sƒ±: <b>${dis.name}</b>. Ne g√∂r√ºyorsunuz?`, () => {
            if(dis.cat === "NEURO") this.neuro();
            else if(dis.cat === "META") this.meta();
            else if(dis.cat === "HEART") this.heart();
            else if(dis.cat === "ALLERGY") this.allergy();
            else this.general();
        });
    },
    type: function(msg, cb) {
        const box = document.getElementById('chat-box');
        const d = document.createElement('div');
        d.className = "msg bot";
        d.innerHTML = "<i>Yazƒ±yor...</i>";
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
        setTimeout(() => { d.innerHTML = msg; if(cb) cb(); }, 600);
    },
    user: function(msg) {
        const box = document.getElementById('chat-box');
        box.innerHTML += `<div class="msg user">${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    },
    ask: function(opts) {
        const div = document.getElementById('chat-opts');
        div.innerHTML = "";
        opts.forEach(o => {
            let b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o.txt;
            b.onclick = () => { this.user(o.txt); div.innerHTML=""; o.act(); };
            div.appendChild(b);
        });
    },
    emerg: function(r) {
        const box = document.getElementById('chat-box');
        box.innerHTML += `<div class="emergency">üö® <b>${r}</b><a href="tel:112" class="call-btn">üìû 112 ARA</a></div>`;
        box.scrollTop = box.scrollHeight;
    },
    
    // SENARYOLAR
    neuro: function() {
        this.ask([
            {txt:"N√∂bet Ge√ßiriyor", act:() => {
                this.type("‚ö†Ô∏è Sakin olun. Ba≈üƒ±nƒ± koruyun. <b>AƒûZINI A√áMAYIN!</b>", () => {
                    setTimeout(() => {
                        this.type("5 dakikayƒ± ge√ßti mi?", () => {
                            this.ask([{txt:"Evet", act:()=>this.emerg("UZAMI≈û N√ñBET")}, {txt:"Hayƒ±r", act:()=>this.type("‚úÖ Yan √ßevirin.")}]);
                        });
                    }, 2000);
                });
            }},
            {txt:"Baygƒ±n", act:() => {
                this.type("Nefes var mƒ±?");
                this.ask([{txt:"Evet", act:()=>this.type("‚úÖ Yan √ßevirin.")}, {txt:"Hayƒ±r", act:()=>this.emerg("SOLUNUM YOK")}]);
            }}
        ]);
    },
    meta: function() {
        this.ask([
            {txt:"Bilin√ß A√ßƒ±k", act:()=>this.type("üç¨ ≈ûeker/Meyve suyu verin.")},
            {txt:"Baygƒ±n", act:()=> { this.type("‚õî Aƒüzƒ±na bir ≈üey vermeyin!"); this.emerg("Diyabetik Koma"); }}
        ]);
    },
    heart: function() {
        this.ask([
            {txt:"G√∂ƒü√ºs Aƒürƒ±sƒ±", act:()=> { this.type("Yarƒ± oturur pozisyon verin. Aspirin varsa verin."); this.emerg("Kalp Krizi"); }},
            {txt:"Bayƒ±ldƒ±", act:()=>this.type("Sƒ±rt √ºst√º yatƒ±rƒ±n, ayaklarƒ±nƒ± kaldƒ±rƒ±n.")}
        ]);
    },
    allergy: function() {
        this.ask([
            {txt:"≈ûi≈üme / Tƒ±kanma", act:()=> { this.type("üíâ Varsa EpiPen yapƒ±n."); this.emerg("Anafilaksi"); }},
            {txt:"Sadece Ka≈üƒ±ntƒ±", act:()=>this.type("Alerji ilacƒ± verin.")}
        ]);
    },
    general: function() {
        this.ask([
            {txt:"Bilin√ß Yok", act:()=> { this.type("Nefes yoksa Kalp Masajƒ± yapƒ±n."); this.emerg("Bilin√ß Kaybƒ±"); }},
            {txt:"Kanama", act:()=> { this.type("ü©∏ Yaraya bastƒ±rƒ±n."); this.emerg("Kanama"); }}
        ]);
    }
};

App.init();
</script>
</body>
</htm